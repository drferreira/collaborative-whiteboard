<ui:composition template="../../templates/generic.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="pageContent">
        <h:form id="votingForm" prependId="false">
            <p:panel>
                <div id="storyHeader">
                    <h:panelGrid columns="2" style="width: 200px;">
                        <h:outputLabel for="storyCode" value="#{tasks_bundle['task.header.code']}" escape="false"/>
                        <h:outputText id="storyCode" value="#{tasksController.getSelectedStory().code}"/>

                        <h:outputLabel for="storyBranch" value="#{tasks_bundle['task.header.branch']}"
                                       escape="false"/>
                        <h:outputText id="storyBranch" value="#{tasksController.getSelectedStory().branch}"/>

                        <h:outputLabel for="storySubject" value="#{tasks_bundle['task.header.subject']}"
                                       escape="false"/>
                        <h:outputText id="storySubject" value="#{tasksController.getSelectedStory().subject}"/>
                    </h:panelGrid>
                </div>
            </p:panel>

            <p:dataTable id="taskTable" value="#{tasksController.tasks}" var="task" selectionMode="single"
                         rowKey="#{task.id}"
                         selection="#{tasksEditionController.selectedTask}"
                         style="text-align: center;">

                <p:ajax event="rowSelect" update="removeButton,openButton"/>
                <p:ajax event="rowUnselect" update="removeButton,openButton"/>

                <f:facet name="header">
                    <p:toolbar>
                        <f:facet name="left">
                            <p:commandButton id="removeButton" value="#{tasks_bundle['task.btn.remove']}"
                                             styleClass="warning_button" icon="ui-icon-trash"
                                             disabled="#{tasksEditionController.isNotSelected()}"
                                             action="#{tasksController.removeTask()}"
                                             update=":votingForm:taskTable">
                                <p:confirm message="#{backlog['confirmation.remove.text']}"
                                           icon="ui-icon-alert"/>
                            </p:commandButton>

                            <p:commandButton value="#{tasks_bundle['task.btn.create']}" icon="ui-icon-plus"
                                             onclick="PF('creationTask').show();" update=":creationTaskForm"/>

                            <p:commandButton id="openButton" value="#{tasks_bundle['task.btn.open']}"
                                             icon="ui-icon-folder-open"
                                             disabled="#{tasksEditionController.isNotSelected()}"
                                             onclick="PF('editionTask').show();" update=":editionForm"/>
                        </f:facet>
                    </p:toolbar>
                </f:facet>

                <p:column headerText="#{tasks_bundle['task.status']}" style="width: 70px;">
                    <h:outputText value="#{task.taskStatus}"/>
                </p:column>

                <p:column headerText="#{tasks_bundle['task.code']}" style="width: 200px;">
                    <h:outputText value="#{task.code}"/>
                </p:column>

                <p:column headerText="#{tasks_bundle['task.estimated']}" style="width: 180px;">
                    <p:calendar value="#{task.estimatedTime}" readonly="true" mask="true" pattern="HH:mm"/>
                </p:column>

                <p:column headerText="#{tasks_bundle['task.subject']}">
                    <h:outputText value="#{task.subject}"/>
                </p:column>

                <p:column headerText="#{tasks_bundle['task.responsible']}" style="width: 350px">
                    <h:outputText value="#{task.responsible}"/>
                </p:column>
            </p:dataTable>
        </h:form>

        <p:dialog widgetVar="editionTask" modal="true" resizable="false">
            <h:form id="editionForm" prependId="false">
                <h:panelGrid columns="1">
                    <p:calendar id="timeEdition" pattern="HH:mm" timeOnly="true" required="true"
                                value="#{tasksEditionController.taskEdition.time}"
                                style="width: 40px"
                                requiredMessage="#{tasks_bundle['mandatory_message.time']}"/>

                    <p:inputText id="taskSubjectEdition" required="true"
                                 value="#{tasksEditionController.taskEdition.subject}"
                                 size="67" requiredMessage="#{tasks_bundle['mandatory_message.subject']}"/>

                    <p:focus context="descriptionEdition"/>

                    <p:editor id="descriptionEdition" rows="20" cols="70"
                                     value="#{tasksEditionController.taskEdition.description}"/>

                </h:panelGrid>

                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton value="#{tasks_bundle['edition.btn.save']}"
                                         update="@form,:votingForm:taskTable" action="#{tasksEditionController.save()}"/>

                        <p:commandButton value="#{tasks_bundle['edition.btn.cancel']}" immediate="true"
                                         onclick="PF('editionTask').hide()"/>
                    </f:facet>
                </p:toolbar>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="creationTask" modal="true" resizable="false">
            <h:form id="creationTaskForm" prependId="false">
                <h:panelGrid columns="2">
                    <p:watermark value="#{tasks_bundle['edition.collum.time']}" for="time"/>

                    <p:calendar id="time" pattern="HH:mm" timeOnly="true" required="true"
                                value="#{taskCreationController.taskCreation.time}"
                                style="width: 40px;margin-left: -7px;"
                                requiredMessage="#{tasks_bundle['mandatory_message.time']}"/>

                    <p:watermark value="#{tasks_bundle['edition.collum.subject']}" for="taskSubject"/>

                    <p:inputText id="taskSubject" required="true"
                                 value="#{taskCreationController.taskCreation.subject}" style="margin-left: -7px;"
                                 size="67" requiredMessage="#{tasks_bundle['mandatory_message.subject']}"/>

                </h:panelGrid>

                <p:focus context="description"/>

                <p:editor id="description" rows="20" cols="70"
                                 value="#{taskCreationController.taskCreation.description}"/>


                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton value="#{tasks_bundle['edition.btn.save']}"
                                         action="#{taskCreationController.createTask()}"
                                         update="@form,:votingForm:taskTable"/>

                        <p:commandButton value="#{tasks_bundle['edition.btn.cancel']}" immediate="true"
                                         onclick="PF('creationTask').hide()"/>
                    </f:facet>
                </p:toolbar>
            </h:form>
        </p:dialog>

        <p:confirmDialog global="true" widgetVar="confirmationDialog" modal="true" resizable="false">
            <p:outputPanel>
                <h:panelGrid columns="2">
                    <h:form>
                        <p:commandButton value="#{backlog['btn.save']}"
                                         styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="#{backlog['btn.cancel']}"
                                         type="button"
                                         styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </h:form>
                </h:panelGrid>
            </p:outputPanel>
        </p:confirmDialog>
    </ui:define>
</ui:composition>