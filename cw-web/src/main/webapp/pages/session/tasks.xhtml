<ui:composition template="../../templates/generic.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="pageContent">
        <h:form id="tasksForm">
            <div class="tasksHeaderArea">
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton value="#{tasks_bundle['task.btn.create']}" icon="ui-icon-plus"
                                         onclick="PF('creationTask').show();" update=":creationTaskForm"/>
                    </f:facet>
                </p:toolbar>
            </div>

            <div class="headerDataArea">

                <h:outputLabel for="storyCode" styleClass="highlighted_font spaced_text"
                               value="#{tasks_bundle['task.header.code']}"/>

                <h:outputText id="storyCode" styleClass="standart_font spaced_text"
                              value="#{tasksController.getSelectedStory().code}"/>

                <h:outputLabel styleClass="vertical_separator"
                               value="#{iteration_settings['iteration.vertical.separator']}"/>

                <h:outputLabel for="storyBranch" styleClass="highlighted_font spaced_text"
                               value="#{tasks_bundle['task.header.branch']}"
                               escape="false"/>

                <h:outputText id="storyBranch" styleClass="standart_font spaced_text"
                              value="#{tasksController.getSelectedStory().branch}"/>

                <h:outputLabel styleClass="vertical_separator"
                               value="#{iteration_settings['iteration.vertical.separator']}"/>

                <h:outputLabel for="storySubject" styleClass="highlighted_font spaced_text"
                               value="#{tasks_bundle['task.header.subject']}"/>

                <h:outputText id="storySubject" styleClass="standart_font spaced_text"
                              value="#{tasksController.getSelectedStory().subject}"/>
            </div>

            <div class="tasksArea">
                <p:dataTable id="taskTable" styleClass="taskTable" value="#{tasksController.tasks}" var="task"
                             selectionMode="single"
                             rowKey="#{task.id}"
                             selection="#{tasksEditionController.selectedTask}"
                             style="text-align: center;"
                             rowStyleClass="#{tasksController.isRemoved(task) ? 'storyRemoved' : null}">

                    <p:column style="width: 22px;">
                        <div style="height: 20px; width: 20px; margin-left: 1px;"
                             class="color_#{tasksController.getStatus(task)}"/>
                    </p:column>

                    <p:column headerText="#{tasks_bundle['task.code']}" style="width: 200px;">
                        <h:outputText value="#{task.code}"/>
                    </p:column>

                    <p:column headerText="#{tasks_bundle['task.estimated']}" style="width: 180px;">
                        <p:calendar value="#{task.estimatedTime}" readonly="true" mask="true" pattern="HH:mm"/>
                    </p:column>

                    <p:column headerText="#{tasks_bundle['task.subject']}">
                        <h:outputText value="#{task.subject}"/>
                    </p:column>

                    <p:column headerText="#{tasks_bundle['task.responsible']}">
                        <h:outputText value="#{tasksController.getResponsible(task)}"/>
                    </p:column>
                </p:dataTable>
            </div>

            <p:contextMenu id="contextMeuTask" for="taskTable" widgetVar="contextMeuTask">
                <p:menuitem value="#{tasks_bundle['task.btn.open']}" icon="ui-icon-folder-open"
                            oncomplete="PF('editionTask').show()" update=":tasksForm:taskTable :editionTask"/>
            </p:contextMenu>

        </h:form>

        <p:dialog id="editionTask" widgetVar="editionTask" modal="true" resizable="false" appendToBody="false">
            <p:outputPanel id="taskDetailPanel">
                <h:form id="editionForm" prependId="false">
                    <p:toolbar>
                        <f:facet name="left">
                            <p:commandButton value="#{tasks_bundle['edition.btn.save']}"
                                             update="@form,:tasksForm:taskTable"
                                             action="#{tasksEditionController.save()}"/>

                            <p:commandButton icon="ui-icon-play" disabled="#{!tasksEditionController.isAvaliableInit()}"
                                             value="#{tasks_bundle['edition.btn.assign']}"
                                             action="#{tasksEditionController.init()}"
                                             update=":editionForm :tasksForm"/>

                            <p:commandButton icon="ui-icon-stop" disabled="#{!tasksEditionController.isAvaliableStop()}"
                                             value="#{tasks_bundle['edition.btn.stop']}"
                                             action="#{tasksEditionController.stop()}"
                                             update=":editionForm :tasksForm"/>

                            <p:commandButton icon="ui-icon-star" value="#{tasks_bundle['edition.btn.end']}"
                                             disabled="#{!tasksEditionController.isAvaliableEnd()}"
                                             action="#{tasksEditionController.end()}"
                                             update=":editionForm :tasksForm" styleClass="green_button"/>
                        <span class="ui-separator">
                            <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                        </span>

                            <p:commandButton icon="ui-icon-seek-prev"
                                             value="Voltar"
                                             action="#{tasksEditionController.previousStage()}"
                                             disabled="#{tasksEditionController.previousStageName() eq tasksEditionController.EMPTY_STAGE_PREVIOUS ? true : false }"
                                             update=":editionForm,:tasksForm:taskTable">
                                <p:confirm message="#{tasks_bundle['edition.stages.next.confirmation']}"
                                           icon="ui-icon-alert"/>
                            </p:commandButton>

                            <p:spacer width="10"/>

                            <p:outputLabel id="stage" value="#{tasksEditionController.taskEdition.stage.name}"/>

                            <p:spacer width="10"/>

                            <p:commandButton icon="ui-icon-seek-next"
                                             value="Avancar"
                                             action="#{tasksEditionController.nextStage()}"
                                             disabled="#{tasksEditionController.nextStageName() eq tasksEditionController.EMPTY_STAGE_NEXT ? true : false}"
                                             update=":editionForm,:tasksForm:taskTable">
                                <p:confirm message="#{tasks_bundle['edition.stages.next.confirmation']}"
                                           icon="ui-icon-alert"/>
                            </p:commandButton>
                        </f:facet>

                        <f:facet name="right">
                            <p:commandButton id="removeButton" styleClass="warning_button" icon="ui-icon-trash"
                                             value="#{tasks_bundle['task.btn.remove']}"
                                             update=":editionForm,:tasksForm:taskTable"
                                             action="#{tasksEditionController.removeTask()}"
                                             disabled="#{!tasksEditionController.isAvailableRemove()}">
                                <p:confirm message="#{backlog['confirmation.remove.text']}"
                                           icon="ui-icon-alert"/>
                            </p:commandButton>

                        </f:facet>
                    </p:toolbar>

                    <p:tabView style="width: 830px; height: 380px;">
                        <p:tab title="#{tasks_bundle['edition.tab.description']}">
                            <h:panelGrid columns="1">
                                <p:calendar id="timeEdition" pattern="HH:mm" timeOnly="true" required="true"
                                            value="#{tasksEditionController.taskEdition.time}"
                                            style="width: 40px"
                                            requiredMessage="#{tasks_bundle['mandatory_message.time']}"/>


                                <p:inputText id="taskSubjectEdition" required="true"
                                             value="#{tasksEditionController.taskEdition.subject}"
                                             size="67" requiredMessage="#{tasks_bundle['mandatory_message.subject']}"/>

                                <p:focus for="descriptionEdition"/>

                                <p:editor id="descriptionEdition" rows="20" cols="70"
                                          value="#{tasksEditionController.taskEdition.description}"/>

                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="#{tasks_bundle['edition.tab.control']}">
                            <p:outputLabel value="#{tasks_bundle['edition.stages.init_flag']}" escape="false"/>

                            <br/>
                            <br/>

                            <p:inputSwitch id="init_flag" value="#{tasksEditionController.taskEdition.initFlag}">
                                <p:ajax listener="#{tasksEditionController.changeInitFlag()}"
                                        update=":editionForm :tasksForm"/>
                            </p:inputSwitch>
                        </p:tab>
                    </p:tabView>
                </h:form>
            </p:outputPanel>
        </p:dialog>

        <p:dialog widgetVar="creationTask" modal="true" resizable="false">
            <h:form id="creationTaskForm" prependId="false">
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton value="#{tasks_bundle['edition.btn.save']}"
                                         action="#{taskCreationController.createTask()}"
                                         update="@form,:tasksForm:taskTable"/>

                        <p:commandButton value="#{tasks_bundle['edition.btn.cancel']}" immediate="true"
                                         onclick="PF('creationTask').hide()"/>
                    </f:facet>
                </p:toolbar>

                <p:spacer height="5px"/>

                <h:panelGrid columns="2">
                    <p:watermark value="#{tasks_bundle['edition.collum.time']}" for="time"/>

                    <p:calendar id="time" pattern="HH:mm" timeOnly="true" required="true"
                                value="#{taskCreationController.taskCreation.time}"
                                style="width: 40px;margin-left: -7px;"
                                requiredMessage="#{tasks_bundle['mandatory_message.time']}"/>

                    <p:watermark value="#{tasks_bundle['edition.collum.subject']}" for="taskSubject"/>

                    <p:inputText id="taskSubject" required="true"
                                 value="#{taskCreationController.taskCreation.subject}" style="margin-left: -7px;"
                                 size="67" requiredMessage="#{tasks_bundle['mandatory_message.subject']}"/>

                </h:panelGrid>

                <p:focus context="description"/>

                <p:editor id="description" rows="20" cols="70"
                          value="#{taskCreationController.taskCreation.description}"/>
            </h:form>
        </p:dialog>

        <p:confirmDialog global="true" widgetVar="confirmationDialog" modal="true" resizable="false">
            <p:outputPanel>
                <h:panelGrid columns="2">
                    <h:form>
                        <p:commandButton value="#{backlog['btn.save']}"
                                         styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="#{backlog['btn.cancel']}"
                                         type="button"
                                         styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </h:form>
                </h:panelGrid>
            </p:outputPanel>
        </p:confirmDialog>
    </ui:define>
</ui:composition>